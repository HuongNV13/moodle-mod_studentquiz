define(["jquery"],function(a){var b={HAS_COMMENTS:{SELECTOR:".studentquiz-container-replies > div.studentquiz-comment-item",CLASS_CHECK:"fromcreator"},initialise:function(c,d){var e=".studentquiz_behaviour > .comments .comment_error",f=a(".studentquiz_behaviour .rate .rating .rateable");f.off("click").on("click",function(a){a.preventDefault(),b.addRating(this)}),f.on("keypress",function(a){13!==a.keyCode&&32!==a.keyCode||(a.preventDefault(),b.addRating(this))}),a('input[name="next"], input[name="previous"], input[name="finish"]').off("click").on("click",function(){var f=a(this),g=!a('.im-controls input[type="submit"]').length||a('.im-controls input[type="submit"]').filter(function(){return this.name.match(/^q.+-submit$/)}).is(":disabled");if(g){var h=a(".rating span").hasClass("star"),i=a(b.HAS_COMMENTS.SELECTOR).hasClass(b.HAS_COMMENTS.CLASS_CHECK);return c&&(h||(a(".studentquiz_behaviour > .rate > .rate_error").removeClass("hide"),a(".studentquiz_behaviour .rate .rating .rateable:first-child").focus())),d&&(i||a(e).removeClass("hide")),!(c&&!h||d&&!i)&&(f.submit(),!0)}return f.submit(),!0})},setFocus:function(){a(document).ready(function(){var b=a("#categoryquestions .iconsort");b&&b.parent().focus()})},addRating:function(b){var c=a(b).attr("data-rate"),d=a(b),e=a(b).closest("form").find(".cmid_field"),f=e.attr("value");a.post(M.cfg.wwwroot+"/mod/studentquiz/save.php",{save:"rate",cmid:f,questionid:a(b).attr("data-questionid"),sesskey:M.cfg.sesskey,rate:c},function(){var b=d.closest(".rating").children("span");b.removeClass("star"),b.addClass("star-empty"),b.each(function(){a(this).attr("data-rate")<=c&&(a(this).removeClass("star-empty"),a(this).addClass("star"))}),a(".studentquiz_behaviour > .rate > .rate_error").addClass("hide")})}};return b});